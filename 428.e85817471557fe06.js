(()=>{"use strict";var ze={8795:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Accidental=void 0;var e,n=function(e){return e[e.DOUBLE_FLAT=-2]="DOUBLE_FLAT",e[e.FLAT=-1]="FLAT",e[e.NATURAL=0]="NATURAL",e[e.SHARP=1]="SHARP",e[e.DOUBLE_SHARP=2]="DOUBLE_SHARP",e}(n||(t.Accidental=n={}));(e=n||(t.Accidental=n={})).names=["bb","b","","#","##"],e.toString=function i(r){if(r>2||r<-2)throw"Accidental outside of expected range "+r;return e.names[r+2]},e.fromString=function c(r){const s=e.names.indexOf(r);if(-1!=s)return s-2}},560:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChordQuality=void 0;var n=function(e){return e[e.DIMINISHED=-2]="DIMINISHED",e[e.MINOR=-1]="MINOR",e[e.MAJOR=1]="MAJOR",e[e.AUGMENTED=2]="AUGMENTED",e}(n||(t.ChordQuality=n={}))},9508:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Chord=void 0;const e=n(5442),i=n(4748),c=n(560),r=n(7320),s=n(4028),o=n(4755);t.Chord=class l{constructor(f){this._update=()=>{const a=[...new Set(this._notes)].filter(o.isDefined),h=a.find(I=>{const ae=new s.AbsoluteNote(I.letterName,I.accidental,0),ie=a.map(P=>new i.Interval(ae,P));if(ie.findIndex(i.Interval.ofSize("2"))<0&&ie.findIndex(i.Interval.ofSize("4"))&&ie.findIndex(i.Interval.ofSize("6"))<0)return!0});if(!h)throw"Must have a root";this._root=new e.Note(h.letterName,h.accidental);const u=a.map(I=>new i.Interval(this._root,I)),g=u.find(i.Interval.ofSize("5"));g&&(g.quality==r.IntervalQuality.AUGMENTED?this._quality=c.ChordQuality.AUGMENTED:g.quality==r.IntervalQuality.DIMINISHED&&(this._quality=c.ChordQuality.DIMINISHED));const d=u.find(i.Interval.ofSize("3"));d&&(d.quality==r.IntervalQuality.MAJOR?this._quality=c.ChordQuality.MAJOR:d.quality==r.IntervalQuality.MINOR&&(this._quality=c.ChordQuality.MINOR));const U=u.find(i.Interval.ofSize("7"));this._seventhQuality=U?U.quality:null},this._notes=f,this._update()}get seventhQuality(){return this._seventhQuality}get quality(){return this._quality}}},6600:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CompleteChord=void 0;const e=n(4748);t.CompleteChord=class i{constructor(r,s,o={}){this._voices=r,this._romanNumeral=s,this._flags=o}get voices(){return this._voices}get intervals(){return this._intervals||(this._intervals=this._voices.map(r=>new e.Interval(this._romanNumeral.root,r))),this._intervals}get romanNumeral(){return this._romanNumeral}get romanNumeralFinalized(){return!0}get flags(){return this._flags}}},7254:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HarmonizedChord=void 0;const e=n(4748);t.HarmonizedChord=class i{constructor({voices:r,romanNumeral:s,flags:o}){this._voices=r||[],this._romanNumeral=s,this._flags=o||{}}get voices(){return this._voices}get intervals(){return this._intervals||(this._intervals=this._voices.map(r=>r?new e.Interval(this._romanNumeral.root,r):void 0)),this._intervals}get romanNumeral(){return this._romanNumeral}get romanNumeralFinalized(){return!0}get flags(){return this._flags}}},6195:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IncompleteChord=void 0;const e=n(4748);t.IncompleteChord=class i{constructor({voices:r,romanNumeral:s,flags:o}){this._voices=r||[],this._romanNumeral=s,this._flags=o||{}}get voices(){return this._voices}get romanNumeral(){return this._romanNumeral}get romanNumeralFinalized(){return!1}get flags(){return this._flags}get intervals(){var r;const s=null===(r=this._romanNumeral)||void 0===r?void 0:r.root;return!this._intervals&&s&&(this._intervals=this._voices.map(o=>o?new e.Interval(s,o):void 0)),this._intervals}}},4227:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Expansion=t.ExpansionType=void 0;const e=n(278),i=n(6991),c=n(560),r=n(7229),s=n(4755);var o=function(A){return A[A.PREFIX=0]="PREFIX",A[A.FULL=1]="FULL",A}(o||(t.ExpansionType=o={}));const{I:a,II:h,III:u,IV:g,V:d,VI:U,VII:I}=r.ScaleDegree.ALIASED,ae=c.ChordQuality.MAJOR,ie=c.ChordQuality.MINOR,P=c.ChordQuality.DIMINISHED;var O,A;(A=O||(t.Expansion=O={})).basicInversions=[{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(a,{inversions:[0,1]}),expansion:[(0,e.matchAsIs)(I,{inversions:[1],chordQuality:P})]},{type:o.PREFIX,priority:10,target:(0,e.match)(a),expansion:[(0,e.matchAsIs)(d,{inversions:[1]})]}],A.dominantInversions=[{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(a,{inversions:[0,1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[2],hasSeventh:!0})]},{type:o.FULL,target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[3],hasSeventh:!0})]},{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(a),expansion:[(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[2],hasSeventh:!0})]},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(a),expansion:[(0,e.matchAsIs)(d,{inversions:[2],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0})]},{type:o.FULL,source:(0,e.match)(a,{inversions:[1]}),target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[3],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[2],hasSeventh:!0})]},{type:o.FULL,source:(0,e.match)(a,{inversions:[1]}),target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[2],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[3],hasSeventh:!0})]},{type:o.PREFIX,target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[3],hasSeventh:!0})]},{type:o.PREFIX,priority:20,target:(0,e.match)(a),expansion:[(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0})]}],A.subdominant=[{type:o.FULL,source:(0,e.match)(h,{inversions:[0,1]}),target:(0,e.match)(h,{inversions:[0,1]}),expansion:[(0,e.match)(a,{inversions:[1]})]}],A.cadential64=[{type:o.PREFIX,priority:20,target:(0,e.matchAsIs)(d),expansion:[(0,e.match)(a,{inversions:[2]})]}],A.submediant=[{type:o.FULL,source:(0,e.matchAsIs)(U,{chordQuality:ie}),expansion:[(0,e.matchAsIs)(d,{inversions:[1]}),(0,e.matchAsIs)(a)]},{type:o.FULL,source:(0,e.matchAsIs)(U,{chordQuality:ie}),expansion:[(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0}),(0,e.matchAsIs)(a)]},{type:o.FULL,source:(0,e.matchAsIs)(g,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[1]}),(0,e.match)(a)]},{type:o.FULL,source:(0,e.matchAsIs)(g,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0}),(0,e.match)(a)]}],A.subdominantSevenths=[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(a),expansion:[(0,e.match)(h,{inversions:[3],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[1]})]},{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(a),expansion:[(0,e.match)(h,{inversions:[3],hasSeventh:!0}),(0,e.matchAsIs)(d,{inversions:[1],hasSeventh:!0})]}],A.tonicSubstitutes=[{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(a,{inversions:[0,1]}),expansion:[(0,e.match)(g)]},{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.match)(U)]},{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(a,{inversions:[1]}),expansion:[(0,e.match)(g,{inversions:[1]})]},{type:o.FULL,source:(0,e.matchAsIs)(d),target:(0,e.matchAsIs)(d,{inversions:[1]}),expansion:[(0,e.match)(g,{inversions:[1]})]}],A.secondaryDominant=[{type:o.PREFIX,priority:0,target:(0,e.match)(d),expansion:[(0,e.matchAsIs)(d,{inversions:[0,1],applied:d})]},{type:o.FULL,priority:0,target:(0,e.match)(d),expansion:[(0,e.matchAsIs)(d,{inversions:[0,1,2],applied:d,hasSeventh:!0})]},{type:o.FULL,priority:0,target:(0,e.match)(d,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[2,3],applied:d,hasSeventh:!0})]},{type:o.FULL,priority:0,target:(0,e.match)(d,{inversions:[0,1]}),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,inversions:[1],applied:d})]}],A.mediant=[{type:o.FULL,source:(0,e.matchAsIs)(I),target:(0,e.matchAsIs)(d),expansion:[(0,e.matchAsIs)(g,{inversions:[1],chordQuality:ie})]}],A.sequences=[[g,I,u,U,h,d,a].flatMap((p,Q,k)=>Q>=2?[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(p),expansion:k.slice(0,Q).map(J=>(0,e.match)(J,{flags:{sequence:!0}}))},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(p,{inversions:[Q%2==0?1:0]}),expansion:k.slice(0,Q).map((J,z)=>(0,e.match)(J,{inversions:[z%2==0?1:0],flags:{sequence:!0}}))}]:[]),[U,h,I,u,a,g,h,d].flatMap((p,Q,k)=>Q>=2?[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(p),expansion:k.slice(0,Q).map(J=>(0,e.match)(J,{flags:{sequence:!0}}))},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(p,{inversions:[Q%2==0?1:0]}),expansion:k.slice(0,Q).map((J,z)=>(0,e.match)(J,{inversions:[z%2==0?1:0],flags:{sequence:!0}}))}]:[]),[d,h,U,u,I,g,a].flatMap((p,Q,k)=>Q>=2?[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(p),expansion:k.slice(0,Q).map(J=>(0,e.match)(J,{flags:{sequence:!0}}))},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(p,{inversions:[Q%2==0?1:0]}),expansion:k.slice(0,Q).map((J,z)=>(0,e.match)(J,{inversions:[z%2==0?1:0],flags:{sequence:!0}}))}]:[]),[d,h,U,g,a].flatMap((p,Q,k)=>Q>=2?[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(p),expansion:k.slice(0,Q).map(J=>(0,e.match)(J,{flags:{sequence:!0}}))},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(p,{inversions:[Q%2==0?1:0]}),expansion:k.slice(0,Q).map((J,z)=>(0,e.match)(J,{inversions:[z%2==0?1:0],flags:{sequence:!0}}))}]:[]),[d,U,u,g,a,h].flatMap((p,Q,k)=>Q>=2?[{type:o.FULL,source:(0,e.match)(a),target:(0,e.match)(p),expansion:k.slice(0,Q).map(J=>(0,e.match)(J,{flags:{sequence:!0}}))},{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(p,{inversions:[Q%2==0?1:0]}),expansion:k.slice(0,Q).map((J,z)=>(0,e.match)(J,{inversions:[z%2==0?1:0],flags:{sequence:!0}}))}]:[])].flat(),A.leadingToneSevenths=[{type:o.PREFIX,priority:0,target:(0,e.matchAsIs)(a),expansion:[(0,e.match)(I,{chordQuality:P,hasSeventh:!0})]},{type:o.PREFIX,priority:0,target:(0,e.matchAsIs)(a,{inversions:[1]}),expansion:[(0,e.match)(I,{chordQuality:P,inversions:[1],hasSeventh:!0})]}],A.otherSeventhChords=[[{primaryInversion:0,secondaryInversion:0,hasSeventh:!0},{primaryInversion:0,secondaryInversion:0,hasSeventh:!1},{primaryInversion:1,secondaryInversion:0,hasSeventh:!1},{primaryInversion:2,secondaryInversion:0,hasSeventh:!1},{primaryInversion:2,secondaryInversion:0,hasSeventh:!0},{primaryInversion:3,secondaryInversion:1,hasSeventh:!0},{primaryInversion:3,secondaryInversion:1,hasSeventh:!1}].flatMap(({primaryInversion:p,secondaryInversion:Q,hasSeventh:k})=>[g,I,u,U,h,d,a].flatMap((J,z,v)=>z>=2?[{type:o.FULL,source:(0,e.match)(a,{inversions:[0,1]}),target:(0,e.match)(J,{hasSeventh:J!=a&&(z%2!=1||k),inversions:J==a?[0]:z%2==1?[Q]:[p]}),expansion:v.slice(0,z).map((C,j)=>(0,e.match)(C,{chordQuality:C==d?ae:void 0,matchingQuality:C==d,hasSeventh:j%2!=1||k,inversions:j%2==1?[Q]:[p],flags:{sequence:!0}}))}]:[]))].flat(),A.secondaryDominants=[...[h,u,g,d,U,I].flatMap(p=>[{type:o.PREFIX,priority:0,target:(0,e.match)(p),expansion:[(0,e.matchAsIs)(d,{inversions:[0,1],applied:p})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p),expansion:[(0,e.matchAsIs)(d,{inversions:[0,1,2],applied:p,hasSeventh:!0})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p,{inversions:[1]}),expansion:[(0,e.matchAsIs)(d,{inversions:[2,3],applied:p,hasSeventh:!0})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p,{inversions:[0,1]}),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,inversions:[1],applied:p})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,hasSeventh:!0,fullyDiminishedSeventh:!0,inversions:[0],applied:p})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p,{inversions:[1]}),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,hasSeventh:!0,fullyDiminishedSeventh:!0,inversions:[1,2],applied:p})]},{type:o.PREFIX,priority:0,target:(0,e.match)(p,{inversions:[2]}),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,hasSeventh:!0,fullyDiminishedSeventh:!0,inversions:[3],applied:p})]}]),...[u,g,d,U,I].flatMap(p=>[{type:o.PREFIX,priority:0,target:(0,e.matchAsIs)(p),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,hasSeventh:!0,fullyDiminishedSeventh:!1,inversions:[0],applied:p})]},{type:o.PREFIX,priority:0,target:(0,e.matchAsIs)(p,{inversions:[1]}),expansion:[(0,e.matchAsIs)(I,{chordQuality:P,hasSeventh:!0,fullyDiminishedSeventh:!1,inversions:[1],applied:p})]}])],A.defaultExpansions=[...A.basicInversions,...A.dominantInversions,...A.subdominant,...A.cadential64,...A.submediant,...A.subdominantSevenths,...A.tonicSubstitutes,...A.secondaryDominant,...A.secondaryDominants,...A.sequences,...A.leadingToneSevenths,...A.otherSeventhChords,...A.mediant],A.matchingExpansions=function*G(p,Q,k,J=A.defaultExpansions){yield[k];const z=J.filter(_=>!(_.source&&!(0,e.checkAgainstRule)(Q,_.source)||_.target&&!(0,e.checkAgainstRule)(k,_.target))).reduce((_,T)=>Object.assign(Object.assign({},_),{[T.type]:[..._[T.type]||[],T]}),{});for(const _ of z[o.FULL]||[]){const T=(0,i.product)(..._.expansion.map(K=>Array.from((0,e.yieldChordsFromRule)(K,p))),[k]);for(const K of T)yield K}const v=(z[o.PREFIX]||[]).reduce((_,T)=>Object.assign(Object.assign({},_),{[T.priority]:[..._[T.priority]||[],T]}),{}),C=Object.keys(v).sort(),j=(0,i.product)(...C.map(_=>v[_]).map(_=>[void 0,..._.flatMap(T=>T.expansion.flatMap(K=>Array.from((0,e.yieldChordsFromRule)(K,p))))]),[k]);for(const _ of j)yield _.filter(s.isDefined)}},9035:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Harmonizer=void 0;const e=n(7254),i=n(7069),c=n(8496),r=n(3781),s=n(4755),o=n(4227),l=n(3508),m=n(6213),f=n(1348),a=n(7229),h=n(560),u=n(3749),g=n(6991),d=n(9355);function U(P,O){var A,G;for(const p in P.voices)if((null===(A=P.voices[p])||void 0===A?void 0:A.name)!==(null===(G=O.voices[p])||void 0===G?void 0:G.name))return!1;if(P.romanNumeral.root.name!==O.romanNumeral.root.name||P.romanNumeral.name!==O.romanNumeral.name||P.romanNumeral.scale[0]!==O.romanNumeral.scale[0]||P.romanNumeral.scale[1]!==O.romanNumeral.scale[1])return!1;if(P.flags){if(!O.flags)return!1;for(const p in P.flags)if(O.flags&&P.flags[p]!==O.flags[p])return!1}return!(O.flags&&!P.flags||P.romanNumeral.name!==O.romanNumeral.name)}function I(P,O){var A,G,p,Q,k,J,z,v,C;const j=(R,V)=>!R||!V||R==V;for(const R in P.voices)if(!j(null===(A=P.voices[R])||void 0===A?void 0:A.name,null===(G=O.voices[R])||void 0===G?void 0:G.name))return null;if(!(j(P.romanNumeral.root.name,null===(Q=null===(p=O.romanNumeral)||void 0===p?void 0:p.root)||void 0===Q?void 0:Q.name)&&j(P.romanNumeral.name,null===(k=O.romanNumeral)||void 0===k?void 0:k.name)&&j(P.romanNumeral.scale[0],null===(J=O.romanNumeral)||void 0===J?void 0:J.scale[0])&&j(P.romanNumeral.scale[1],null===(z=O.romanNumeral)||void 0===z?void 0:z.scale[1])))return null;if(P.flags)for(const R in P.flags)if(O.flags&&void 0!==O.flags[R]&&P.flags[R]!==O.flags[R])return null;if(O.flags)for(const R in O.flags)if(P.flags&&void 0!==P.flags[R]&&P.flags[R]!==O.flags[R])return null;if(P.romanNumeral){const R=P.romanNumeral,V=R?.intervals.map(Y=>R.root?Y.transposeUp(R.root).simpleName:void 0);if(!O.voices.filter(s.isDefined).every(Y=>V.includes(Y.simpleName)))return null}else if(O.romanNumeral){const R=O.romanNumeral,V=R.intervals.map(Y=>R.root?Y.transposeUp(R.root).simpleName:void 0);if(!P.voices.filter(s.isDefined).every(Y=>V.includes(Y.simpleName)))return null}const _=null===(v=P.romanNumeral||O.romanNumeral)||void 0===v?void 0:v.with(Object.assign(Object.assign({},P.romanNumeral.flags),null===(C=O.romanNumeral)||void 0===C?void 0:C.flags)),T=[...new Array(Math.max(P.voices.length,O.voices.length))].map((R,V)=>P.voices[V]||O.voices[V]),K=Object.assign(Object.assign({},P.flags||{}),O.flags||{});return new e.HarmonizedChord({romanNumeral:_,voices:T,flags:K})}class ae{constructor(){this.cache=[]}getOrSet(O,A,G){const p=Object.assign(Object.assign({},A.asParams()),{scale:A.scale}),Q=JSON.stringify(p,Object.keys(p).sort());return this.cache[O]||(this.cache[O]={}),this.cache[O][Q]||(this.cache[O][Q]=G()),this.cache[O][Q]}}t.Harmonizer=class ie{constructor(O){this.params=O}*nextHarmony(O,A,G){var p,Q;if(A>=O.length)return;const k=O[A];let J=!this.params.useProgressions;const v=(null===(p=k.romanNumeral)||void 0===p?void 0:p.scale)||G.scale,C=[...i.Progression.matchingProgressions(v,G,this.params.enabledProgressions||i.Progression.defaultProgressions)];if(this.params.canModulate&&(null===(Q=k.romanNumeral)||void 0===Q||!Q.scale)){const j=G.scale,_=this.params.modulationsAllowed,T=R=>[[R,r.Scale.Quality.MAJOR],[R,r.Scale.Quality.MINOR]],K=_?_.map(R=>l.Key.fromString(R.transposeUp(l.Key.toNote(j[0])).name)).flatMap(T):l.Key.names.map(l.Key.fromString).flatMap(T);C.push(...C.flatMap(R=>K.map(V=>{if(V===R.scale)return;const Y=R.relativeToScale(V);if(Y){const ee=Object.assign({},R.flags);return ee.pivot=!0,Y.with({flags:ee})}})).filter(s.isDefined))}for(const j of C){const T=[...o.Expansion.matchingExpansions(v,G,j,this.params.enabledExpansions||o.Expansion.defaultExpansions)];T.sort((Y,ee)=>ee.length-Y.length);const R=[...u.Substitution.matchingSubstitutions(v,j,this.params.enabledSubstitutions||u.Substitution.defaultSubstitutions)],V=(0,d.iteratorMap)((0,g.product)(T,R),([Y,ee])=>[...Y.slice(0,Y.length-1),ee]);for(const Y of V)if(A+Y.length<=O.length){if(Y.some(ee=>!ee))continue;if(J){J=!1;for(let ee=0;ee<Y.length;ee++){const{romanNumeral:ce,voices:S,flags:w}=O[ee+A];if(!ce||!U(new e.HarmonizedChord({romanNumeral:Y[ee]}),new e.HarmonizedChord({romanNumeral:ce,voices:S,flags:w}))){J=!0;break}}}yield[Y,j]}}if(k.romanNumeral&&J){const{romanNumeral:j}=k;yield[[j],j]}}*matchingHarmony(O,A,G){if(!(A>=O.length))for(const[p,Q]of this.nextHarmony(O,A,G)){let k=0;const J=Array(p.length);for(;k<p.length;k++){const z=I(new e.HarmonizedChord({romanNumeral:p[k]}),O[A+k]);if(null===z)break;J[k]=z}k===p.length&&(yield[J,Q])}}*checkCache(O,A,G,p){!this.params.disableCaching&&p?yield*p.getOrSet(A,G,()=>(0,f.convertToMultiIterator)(this.matchingCompleteHarmonyWithContext(O,A,G,p))):yield*this.matchingCompleteHarmonyWithContext(O,A,G)}*matchingCompleteHarmonyWithContext(O,A,G,p){if(!(A>=O.length))for(const[Q,k]of this.matchingHarmony(O,A,G)){const J=(0,m.makePeekableIterator)(this.checkCache(O,A+Q.length,k,p));(J.hasItems||Q.length+A===O.length)&&(yield[Q,J[Symbol.iterator]()])}}*matchingCompleteHarmony(O,A){if(0===O.length)return;const G=O[0].romanNumeral||new c.RomanNumeral({scaleDegree:a.ScaleDegree.TONIC,quality:A[1]===r.Scale.Quality.MAJOR?h.ChordQuality.MAJOR:h.ChordQuality.MINOR},A),p=I(new e.HarmonizedChord({romanNumeral:G}),O[0]);if(null===p)return;const Q=(0,m.makePeekableIterator)(this.matchingCompleteHarmonyWithContext(O,1,p.romanNumeral,new ae));(Q.hasItems||1===O.length)&&(yield[[p],Q[Symbol.iterator]()])}}},7069:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Progression=void 0;const e=n(278),i=n(560),c=n(7229),r=n(8795),s=([I,ae])=>({source:I,target:ae}),{I:o,II:l,III:m,IV:f,V:a,VI:h,VII:u}=c.ScaleDegree.ALIASED,g=i.ChordQuality.MAJOR,d=i.ChordQuality.DIMINISHED;var U;!function(I){let ae;var P;(P=ae=I.Shared||(I.Shared={})).basic=[[(0,e.match)(o),(0,e.matchAsIs)(a)],[(0,e.matchAsIs)(a),(0,e.match)(o)]].map(s),P.basicInversions=[[(0,e.match)(o),(0,e.match)(o,{inversions:[1]})],[(0,e.match)(o,{inversions:[1]}),(0,e.match)(o)],[(0,e.match)(o,{inversions:[1]}),(0,e.matchAsIs)(a)],[(0,e.match)(o),(0,e.matchAsIs)(a,{inversions:[1]})],[(0,e.matchAsIs)(a,{inversions:[1]}),(0,e.match)(o)],[(0,e.matchAsIs)(a),(0,e.matchAsIs)(a,{inversions:[1]})],[(0,e.matchAsIs)(a,{inversions:[1]}),(0,e.matchAsIs)(a)],[(0,e.matchAsIs)(u,{chordQuality:d,inversions:[1]}),(0,e.match)(o,{inversions:[0,1]})]].map(s),P.dominantSevenths=[[(0,e.match)(o,{inversions:[0,1]}),(0,e.matchAsIs)(a,{inversions:[2],hasSeventh:!0})],[(0,e.matchAsIs)(a,{inversions:[2],hasSeventh:!0}),(0,e.match)(o,{inversions:[0,1]})],[(0,e.match)(o,{inversions:[0,1]}),(0,e.matchAsIs)(a,{inversions:[3],hasSeventh:!0})],[(0,e.matchAsIs)(a,{inversions:[3],hasSeventh:!0}),(0,e.match)(o,{inversions:[1]})],[(0,e.matchAsIs)(a),(0,e.matchAsIs)(a,{inversions:[3],hasSeventh:!0})]].map(s),P.basicPredominant=[[(0,e.match)(o,{inversions:[0,1]}),(0,e.match)(f)],[(0,e.match)(f),(0,e.matchAsIs)(a)],[(0,e.match)(f),(0,e.matchAsIs)(a,{hasSeventh:!0})],[(0,e.match)(o,{inversions:[0,1]}),(0,e.match)(l,{inversions:[0,1]})],[(0,e.match)(l,{inversions:[0,1]}),(0,e.matchAsIs)(a)],[(0,e.match)(l,{inversions:[0,1]}),(0,e.matchAsIs)(a,{hasSeventh:!0})],[(0,e.match)(l,{inversions:[0]}),(0,e.matchAsIs)(a,{inversions:[1]})],[(0,e.match)(l,{inversions:[0,1]}),(0,e.match)(l,{inversions:[0,1]})],[(0,e.match)(l,{inversions:[0,1]}),(0,e.match)(l,{inversions:[0,1]})],[(0,e.match)(f),(0,e.match)(l,{inversions:[0,1]})]].map(s),P.submediant=[[(0,e.match)(o),(0,e.match)(h)],[(0,e.match)(o),(0,e.match)(f,{inversions:[1]})],[(0,e.match)(o),(0,e.match)(h)],[(0,e.match)(h),(0,e.match)(f,{inversions:[0,1]})],[(0,e.match)(f,{inversions:[1]}),(0,e.match)(l,{inversions:[1]})],[(0,e.match)(h),(0,e.match)(l,{inversions:[0,1]})],[(0,e.match)(h),(0,e.matchAsIs)(a)],[(0,e.match)(f,{inversions:[1]}),(0,e.matchAsIs)(a)]].map(s),P.subdominantSevenths=[[(0,e.match)(l,{inversions:[3],hasSeventh:!0}),(0,e.matchAsIs)(a,{inversions:[1],hasSeventh:!1})],[(0,e.match)(l,{inversions:[3],hasSeventh:!0}),(0,e.matchAsIs)(a,{inversions:[1],hasSeventh:!0})]].map(s),P.tonicSubstitutes=[[(0,e.matchAsIs)(a),(0,e.match)(h)],[(0,e.matchAsIs)(a),(0,e.match)(f,{inversions:[1]})],[(0,e.matchAsIs)(a,{hasSeventh:!0}),(0,e.match)(h)],[(0,e.matchAsIs)(a,{hasSeventh:!0}),(0,e.match)(f,{inversions:[1]})]].map(s),P.mediant=[[(0,e.match)(o),(0,e.match)(m)],[(0,e.match)(m),(0,e.matchAsIs)(a,{inversions:[0,1]})],[(0,e.match)(o),(0,e.match)(h)],[(0,e.match)(o),(0,e.match)(f,{inversions:[0,1]})],[(0,e.match)(o),(0,e.match)(l,{inversions:[0,1]})],[(0,e.match)(o),(0,e.matchAsIs)(u,{inversions:[0,1]})],[(0,e.matchAsIs)(u,{inversions:[0,1]}),(0,e.matchAsIs)(m)],[(0,e.matchAsIs)(u,{inversions:[0,1]}),(0,e.matchAsIs)(a,{inversions:[0,1]})]].map(s),P.neopolitan=[[(0,e.match)(o,{inversions:[0,1]}),(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]})],[(0,e.match)(m),(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]})],[(0,e.match)(h),(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]})],[(0,e.match)(f),(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]})],[(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]}),(0,e.matchAsIs)(a)],[(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]}),(0,e.matchAsIs)(a,{chordQuality:g,hasSeventh:!0,inversions:[3]})],[(0,e.matchAsIs)(l,{accidental:r.Accidental.FLAT,chordQuality:g,inversions:[1]}),(0,e.match)(u,{chordQuality:d,hasSeventh:!0,inversions:[2]})]].map(s),I.defaultProgressions=[...I.Shared.basic,...I.Shared.basicInversions,...I.Shared.dominantSevenths,...I.Shared.basicPredominant,...I.Shared.subdominantSevenths,...I.Shared.submediant,...I.Shared.tonicSubstitutes,...I.Shared.mediant,...I.Shared.neopolitan],I.matchingProgressions=function*ie(P,O,A=I.defaultProgressions){yield O;for(const{source:G,target:p}of A)(0,e.checkAgainstRule)(O,G)&&(yield*(0,e.yieldChordsFromRule)(p,P))}}(U||(t.Progression=U={}))},8496:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RomanNumeral=void 0;const e=n(7229),i=n(560),c=n(4748),r=n(7320),s=n(3781),o=n(8795),l=[];function f(h,u,g){return function m(h,u,g){if(l[g[1]]||(l[g[1]]=[]),l[g[1]][h]||(l[g[1]][h]=[]),!l[g[1]][h][u]){const d=s.Scale.getNotesOfScale(g);l[g[1]][h][u]=new c.Interval(d[h],d[u])}return l[g[1]][h][u]}(h,(h+u-1)%7,g)}class a{static fromString(u,g){const U=u.match(/^(b|#)?(?:(VI{0,2}|I{1,3}|IV)(\+)?|(vi{0,2}|i{1,3}|iv)(o|0)?)(?:(53|63?|64)|(7(?:53)?|653?|6?43|6?42))?(?:\/(VI{0,2}|I{2,3}|IV|vi{0,2}|i{2,3}|iv))?$/);if(!U)throw new Error("Invalid roman numeral "+u);const[I,ae,ie,P,O,A,G,p]=U.slice(1),Q=e.ScaleDegree.fromRomanNumeral(ae||P);let k=e.ScaleDegree.fromRomanNumeral(p||"I");k===e.ScaleDegree.TONIC&&(k=null);const J=o.Accidental.fromString(I)||o.Accidental.NATURAL,z=ae?ie?i.ChordQuality.AUGMENTED:i.ChordQuality.MAJOR:O?i.ChordQuality.DIMINISHED:i.ChordQuality.MINOR;let v;if(!A&&!G||"5"==A||"53"==A||"7"==G||"753"==G)v=0;else if("6"==A||"63"==A||"65"==G||"653"==G)v=1;else if("64"==A||"643"==G||"43"==G)v=2;else{if("642"!=G&&"42"!=G)throw new Error("Unknown inversion symbol "+A);v=3}return new a({scaleDegree:Q,quality:z,applied:k,inversion:v,hasSeventh:!!G,accidental:J,fullyDiminishedSeventh:"o"===O},g)}constructor(u,g){this.scaleDegree=u.scaleDegree,this.quality=u.quality,this.inversion=u.inversion||0,this.applied=u.applied||null,this.accidental=u.accidental||o.Accidental.NATURAL,this._intervals=[new c.Interval(r.IntervalQuality.PERFECT,1)],this.hasSeventh=!!u.hasSeventh;let d=r.IntervalQuality.MAJOR,U=r.IntervalQuality.PERFECT;switch(this.quality){case i.ChordQuality.AUGMENTED:U=r.IntervalQuality.AUGMENTED;break;case i.ChordQuality.MAJOR:break;case i.ChordQuality.MINOR:d=r.IntervalQuality.MINOR;break;case i.ChordQuality.DIMINISHED:d=r.IntervalQuality.MINOR,U=r.IntervalQuality.DIMINISHED}if(this._intervals.push(new c.Interval(d,3),new c.Interval(U,5)),this.hasSeventh=u.hasSeventh||!1,u.hasSeventh){let I=r.IntervalQuality.MINOR;switch(u.quality){case i.ChordQuality.AUGMENTED:I=r.IntervalQuality.MAJOR;break;case i.ChordQuality.MAJOR:this.scaleDegree!=e.ScaleDegree.DOMINANT&&this.scaleDegree!==e.ScaleDegree.SUBTONIC&&(I=r.IntervalQuality.MAJOR);break;case i.ChordQuality.MINOR:break;case i.ChordQuality.DIMINISHED:u.fullyDiminishedSeventh&&(I=r.IntervalQuality.DIMINISHED)}this._intervals.push(new c.Interval(I,7))}if(this._inversionInterval=this._intervals[this.inversion],null!==this.applied&&(this.scaleDegree!==e.ScaleDegree.DOMINANT&&this.scaleDegree!==e.ScaleDegree.SUBTONIC||this.scaleDegree===e.ScaleDegree.DOMINANT&&this.quality!==i.ChordQuality.MAJOR||this.scaleDegree===e.ScaleDegree.SUBTONIC&&this.quality!==i.ChordQuality.DIMINISHED))throw new Error("Only V and viio can be applied chords, tried to apply "+e.ScaleDegree.toRomanNumeral(this.scaleDegree));switch(this.scale=g,this.flags=Object.freeze(Object.assign({},u.flags)),this.name=e.ScaleDegree.toRomanNumeral(this.scaleDegree),this.quality){case i.ChordQuality.MINOR:this.name=this.name.toLowerCase();break;case i.ChordQuality.DIMINISHED:this.name=this.name.toLowerCase(),this.name+=!u.hasSeventh||u.fullyDiminishedSeventh?"o":"0";break;case i.ChordQuality.AUGMENTED:this.name+="+"}this.name+=this.inversionString,this.applied&&(this.name+="/"+e.ScaleDegree.toRomanNumeral(this.applied)),this.accidental&&(this.name=o.Accidental.toString(this.accidental)+this.name)}get intervals(){return[...this._intervals]}get notes(){return this.intervals.map(u=>u.transposeUp(this.root))}get root(){const u=s.Scale.getNotesOfScale(this.scale);return this.scaleDegree==e.ScaleDegree.DOMINANT&&this.quality===i.ChordQuality.MAJOR?this.applied?new c.Interval(r.IntervalQuality.PERFECT,5).transposeUp(u[this.applied-1]).applyAccidental(this.accidental):new c.Interval(r.IntervalQuality.PERFECT,5).transposeUp(u[0]):this.scaleDegree===e.ScaleDegree.SUBTONIC&&this.quality===i.ChordQuality.DIMINISHED?this.applied?new c.Interval(r.IntervalQuality.MINOR,2).transposeDown(u[this.applied-1]).applyAccidental(this.accidental):new c.Interval(r.IntervalQuality.MINOR,2).transposeDown(u[0]).applyAccidental(this.accidental):u[this.scaleDegree-1].applyAccidental(this.accidental)}get inversionInterval(){return this._inversionInterval}get inversionSymbol(){if(this.hasSeventh){if("U"==this._inversionInterval.simpleSize)return["7",""];if("3"==this._inversionInterval.simpleSize)return["6","5"];if("5"==this._inversionInterval.simpleSize)return["4","3"];if("7"==this._inversionInterval.simpleSize)return["4","2"]}else{if("U"==this._inversionInterval.simpleSize)return["",""];if("3"==this._inversionInterval.simpleSize)return["6",""];if("5"==this._inversionInterval.simpleSize)return["6","4"]}return["",""]}get inversionString(){return this.inversionSymbol.join("")}relativeToScale(u){var g;if(null!==this.applied)return null;const d=s.Scale.getNotesOfScale(u),U=d.findIndex(ie=>ie.letterName===this.root.letterName),ae=new a({quality:this.quality,scaleDegree:U+1,inversion:this.inversion,hasSeventh:this.hasSeventh,accidental:this.root.accidental-d[U].accidental,fullyDiminishedSeventh:(null===(g=this.intervals.find(ie=>"7"===ie.simpleSize))||void 0===g?void 0:g.quality)===r.IntervalQuality.DIMINISHED},u);return ae.notes.every(ie=>this.notes.some(P=>ie.name===P.name))?ae:null}diatonicized(){const u=s.Scale.getNamesOfScale(this.scale).findIndex(ie=>ie.startsWith(this.root.name[0]));if(-1===u)return null;const g=f(u,3,this.scale).quality,d=f(u,5,this.scale).quality,U=f(u,7,this.scale).quality;let I=i.ChordQuality.MAJOR,ae=!1;switch(d){case r.IntervalQuality.AUGMENTED:I=i.ChordQuality.AUGMENTED;case r.IntervalQuality.DIMINISHED:I=i.ChordQuality.DIMINISHED,(!this.hasSeventh||U===r.IntervalQuality.DIMINISHED)&&(ae=!0);break;case r.IntervalQuality.PERFECT:g===r.IntervalQuality.MINOR&&(I=i.ChordQuality.MINOR)}return new a({quality:I,scaleDegree:u+1,inversion:this.inversion,hasSeventh:this.hasSeventh,fullyDiminishedSeventh:ae,flags:this.flags},this.scale)}asParams(){var u;return{quality:this.quality,scaleDegree:this.scaleDegree,applied:this.applied,accidental:this.accidental,flags:this.flags,fullyDiminishedSeventh:this.hasSeventh&&(null===(u=this.intervals.find(c.Interval.ofSize("7")))||void 0===u?void 0:u.quality)===r.IntervalQuality.DIMINISHED,hasSeventh:this.hasSeventh,inversion:this.inversion}}with(u){return new a(Object.assign(Object.assign({},this.asParams()),u),this.scale)}}t.RomanNumeral=a},278:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.match=function r(m,{chordQuality:f=i.ChordQuality.MAJOR,inversions:a=[0],hasSeventh:h=!1,applied:u,fullyDiminishedSeventh:g,accidental:d=e.Accidental.NATURAL,flags:U,matchingQuality:I=!1}={}){return{scaleDegree:m,chordQuality:f,inversions:a,hasSeventh:h,applied:u,fullyDiminishedSeventh:g,accidental:d,flags:U,matchingQuality:I}},t.matchAsIs=function s(m,{chordQuality:f=i.ChordQuality.MAJOR,inversions:a=[0],hasSeventh:h=!1,applied:u,fullyDiminishedSeventh:g,accidental:d=e.Accidental.NATURAL,flags:U}={}){return{scaleDegree:m,chordQuality:f,inversions:a,hasSeventh:h,applied:u,fullyDiminishedSeventh:g,accidental:d,flags:U,matchingQuality:!0}},t.checkAgainstRule=function o(m,f){return!(m.scaleDegree!==f.scaleDegree||m.quality!==f.chordQuality&&f.matchingQuality||f.inversions&&!f.inversions.includes(m.inversion)||m.hasSeventh!=f.hasSeventh||m.applied!=f.applied&&!m.applied&&!f.applied||m.accidental!==f.accidental&&void 0!==f.accidental||void 0!==f.fullyDiminishedSeventh&&f.fullyDiminishedSeventh!=f.fullyDiminishedSeventh)},t.yieldChordsFromRule=function*l(m,f){for(const a of m.inversions){const h=new c.RomanNumeral({quality:m.chordQuality,scaleDegree:m.scaleDegree,inversion:a,hasSeventh:m.hasSeventh,applied:m.applied,accidental:m.accidental,fullyDiminishedSeventh:m.fullyDiminishedSeventh,flags:m.flags},f);if(m.matchingQuality)yield h;else{const u=h.diatonicized();u&&(yield u)}}};const e=n(8795),i=n(560),c=n(8496)},7229:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScaleDegree=void 0;var e,n=function(e){return e[e.TONIC=1]="TONIC",e[e.SUPERTONIC=2]="SUPERTONIC",e[e.MEDIANT=3]="MEDIANT",e[e.SUBDOMINANT=4]="SUBDOMINANT",e[e.DOMINANT=5]="DOMINANT",e[e.SUBMEDIANT=6]="SUBMEDIANT",e[e.SUBTONIC=7]="SUBTONIC",e}(n||(t.ScaleDegree=n={}));(e=n||(t.ScaleDegree=n={})).romanNumerals=["I","II","III","IV","V","VI","VII"],e.toRomanNumeral=function i(r){return e.romanNumerals[r-1]},e.fromRomanNumeral=function c(r){const s=e.romanNumerals.indexOf(r.toUpperCase());if(s<0)throw"Invalid scale degree "+r;return s+1},e.ALIASED=Object.freeze(Object.fromEntries(e.romanNumerals.map((r,s)=>[r,s+1])))},3749:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Substitution=void 0;const e=n(278),i=n(7229),{II:r,IV:o,V:l}=i.ScaleDegree.ALIASED;var a,h;(h=a||(t.Substitution=a={})).basic=[{target:(0,e.matchAsIs)(l),substitute:(0,e.matchAsIs)(l,{hasSeventh:!0})}],h.dominantInversions=[{target:(0,e.matchAsIs)(l,{inversions:[1]}),substitute:(0,e.matchAsIs)(l,{inversions:[1],hasSeventh:!0})}],h.subdominantSevenths=[{target:(0,e.match)(r),substitute:(0,e.match)(r,{hasSeventh:!0})},{target:(0,e.match)(r,{inversions:[1]}),substitute:(0,e.match)(r,{inversions:[1],hasSeventh:!0})},{target:(0,e.match)(o),substitute:(0,e.match)(o,{hasSeventh:!0})}],h.defaultSubstitutions=[...h.basic,...h.dominantInversions,...h.subdominantSevenths],h.matchingSubstitutions=function*u(g,d,U=h.defaultSubstitutions){yield d;for(const I of U)I.target&&!(0,e.checkAgainstRule)(d,I.target)||(yield*(0,e.yieldChordsFromRule)(I.substitute,g))}},2859:(W,t,n)=>{t.Rj=t.p3=t._E=t.vf=t.Uz=t.L7=t.E3=t.md=t.FE=t.jr=t.U3=void 0;var i=n(4028);Object.defineProperty(t,"U3",{enumerable:!0,get:function(){return i.AbsoluteNote}});var c=n(6195);Object.defineProperty(t,"jr",{enumerable:!0,get:function(){return c.IncompleteChord}});var r=n(3781);Object.defineProperty(t,"FE",{enumerable:!0,get:function(){return r.Scale}});var s=n(9035);Object.defineProperty(t,"md",{enumerable:!0,get:function(){return s.Harmonizer}});var o=n(8496);Object.defineProperty(t,"E3",{enumerable:!0,get:function(){return o.RomanNumeral}});n(4748);var m=n(5442);Object.defineProperty(t,"L7",{enumerable:!0,get:function(){return m.Note}});n(8795),n(7069),n(560),n(7320);var g=n(3508);Object.defineProperty(t,"Uz",{enumerable:!0,get:function(){return g.Key}});n(278);var U=n(5202);Object.defineProperty(t,"vf",{enumerable:!0,get:function(){return U.defaultPartWritingParameters}});n(4227),n(9508),n(7254),n(6600),n(8927),n(7229),n(5271);var p=n(1348);Object.defineProperty(t,"_E",{enumerable:!0,get:function(){return p.flattenResult}});var Q=n(1163);Object.defineProperty(t,"p3",{enumerable:!0,get:function(){return Q.PartWriter}}),Object.defineProperty(t,"Rj",{enumerable:!0,get:function(){return Q.PartWriterParameters}})},5271:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ComplexInterval=void 0;const e=n(4028),i=n(4748),c=n(7320),r=n(1072);t.ComplexInterval=class s extends i.Interval{constructor(l,m){if(m.midi<l.midi)throw"Expected the second note to be higher than the first";super(l,m),this._complexSize=this._simpleSize,(0,r.scalePosition)(l.letterName)<=(0,r.scalePosition)(m.letterName)?this._complexSize+=7*(m.octavePosition-l.octavePosition):this._complexSize+=7*Math.max(m.octavePosition-l.octavePosition-1,0)}get name(){return c.IntervalQuality.toString(this._quality)+this.complexSize}get complexSize(){return 1==this._complexSize?"U":String(this._complexSize)}transposeUp(l){const m=super.transposeUp(l),f=new e.AbsoluteNote(m.letterName,m.accidental,l.octavePosition),a=(this._complexSize-this._simpleSize)/7+((0,r.scalePosition)(l.letterName)>(0,r.scalePosition)(f.letterName)?1:0);return new e.AbsoluteNote(f.letterName,f.accidental,f.octavePosition+a)}transposeDown(l){const m=super.transposeDown(l),f=new e.AbsoluteNote(m.letterName,m.accidental,l.octavePosition),a=(this._complexSize-this._simpleSize)/7+((0,r.scalePosition)(l.letterName)<(0,r.scalePosition)(f.letterName)?1:0);return new e.AbsoluteNote(f.letterName,f.accidental,f.octavePosition-a)}}},7320:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IntervalQuality=void 0;var e,n=function(e){return e[e.DIMINISHED=-2]="DIMINISHED",e[e.MINOR=-1]="MINOR",e[e.PERFECT=0]="PERFECT",e[e.MAJOR=1]="MAJOR",e[e.AUGMENTED=2]="AUGMENTED",e}(n||(t.IntervalQuality=n={}));(e=n||(t.IntervalQuality=n={})).names=["d","m","P","M","A"],e.toString=function i(s){return e.names[s+2]},e.fromString=function c(s){return e.names.indexOf(s)-2},e.invert=function r(s){return e[-s]}},4748:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Interval=void 0;const e=n(5442),i=n(7320),c=n(8795),r=n(4755),s=n(1072),o=["C","D","E","F","G","A","B","C"],l=[0,2,4,5,7,9,11,12];class m{constructor(a,h){if((0,r.isNumber)(a)&&(0,r.isNumber)(h))switch(this._quality=a,this._simpleSize=h,this._semitones=l[this._simpleSize-1],this._quality){case i.IntervalQuality.AUGMENTED:this._semitones+=1;break;case i.IntervalQuality.MINOR:this._semitones-=1;break;case i.IntervalQuality.DIMINISHED:this._semitones-=1==this._simpleSize||4==this._simpleSize||5==this._simpleSize||8==this._simpleSize?1:2}else{if(!(a instanceof e.Note&&h instanceof e.Note))throw"Invalid invocation of Interval constructor with values "+JSON.stringify(a)+" and "+JSON.stringify(h);{let u=(0,s.scalePosition)(h.letterName[0])-(0,s.scalePosition)(a.letterName[0]);u<0&&(u+=7),this._simpleSize=u+1;let g=h.chromaticPosition-a.chromaticPosition;(g<0||0===g&&6===u)&&(g+=12),this._semitones=g;const d=l[this._simpleSize-1];this._quality=1==this._simpleSize||4==this._simpleSize||5==this._simpleSize?m.perfectQualities[g-d+1]:8==this._simpleSize?m.perfectQualities[12+g-d+1]:m.imperfectQualities[g-d+2]}}}static fromString(a){const h=a.match(/^([PMmAd])([U2-7])$/);if(!h)throw a+" is not a valid interval";const[u,g]=h.slice(1),d=i.IntervalQuality.fromString(u),U=Number(g)||1;return new m(d,U)}get semitones(){return this._semitones}get name(){return i.IntervalQuality.toString(this._quality)+this.simpleSize}get simpleSize(){return 1==this._simpleSize?"U":String(this._simpleSize)}get quality(){return this._quality}transposeUp(a){let h=(0,s.scalePosition)(a.letterName)+this._simpleSize-1;h>=7&&(h-=7);const u=o[h],g=new e.Note(u,c.Accidental.NATURAL);return new e.Note(u,(12+a.chromaticPosition+this._semitones-g.chromaticPosition+2)%12-2)}transposeDown(a){let h=(0,s.scalePosition)(a.letterName)-this._simpleSize+1;h<0&&(h+=7);const u=o[h],g=new e.Note(u,c.Accidental.NATURAL);return new e.Note(u,(24+a.chromaticPosition-this._semitones-g.chromaticPosition+2)%12-2)}static ofSize(a){return h=>h&&h.simpleSize==a}}var f;t.Interval=m,(f=m||(t.Interval=m={})).perfectQualities=[i.IntervalQuality.DIMINISHED,i.IntervalQuality.PERFECT,i.IntervalQuality.AUGMENTED],f.imperfectQualities=[i.IntervalQuality.DIMINISHED,i.IntervalQuality.MINOR,i.IntervalQuality.MAJOR,i.IntervalQuality.AUGMENTED]},8927:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Motion=void 0;const e=n(4748);var c,i=function(c){return c[c.PARALLEL=0]="PARALLEL",c[c.SIMILAR=1]="SIMILAR",c[c.OBLIQUE=2]="OBLIQUE",c[c.CONTRARY=3]="CONTRARY",c}(i||(t.Motion=i={}));(c=i||(t.Motion=i={})).names=["PARALLEL","SIMILAR","OBLIQUE","CONTRARY"],c.toString=function r(l){return c.names[l]},c.fromString=function s(l){return c.names.indexOf(l.toUpperCase())},c.from=function o(l,m,f,a){if(l.midi==m.midi&&f.midi==a.midi)return c.PARALLEL;if(l.midi==m.midi||f.midi==a.midi)return c.OBLIQUE;if(Math.sign(l.midi-m.midi)==Math.sign(f.midi-a.midi)){const h=new e.Interval(l,m),u=new e.Interval(f,a);return h.simpleSize===u.simpleSize?c.PARALLEL:c.SIMILAR}return c.CONTRARY}},3508:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0;const e=n(5442),i=n(4748),c=n(8795);var r=function(s){return s[s.CFlat=-7]="CFlat",s[s.GFlat=-6]="GFlat",s[s.DFlat=-5]="DFlat",s[s.AFlat=-4]="AFlat",s[s.EFlat=-3]="EFlat",s[s.BFlat=-2]="BFlat",s[s.F=-1]="F",s[s.C=0]="C",s[s.G=1]="G",s[s.D=2]="D",s[s.A=3]="A",s[s.E=4]="E",s[s.B=5]="B",s[s.FSharp=6]="FSharp",s[s.CSharp=7]="CSharp",s}(r||(t.Key=r={}));!function(s){function o(a){if(a>7||a<-7)throw"Key outside of expected range "+a;return s.names[a+7]}s.names=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"],s.toString=o,s.fromString=function l(a){const h=s.names.indexOf(a);if(-1==h)throw"Invalid key "+a;return h-7},s.toNote=function m(a){return e.Note.fromString(o(a))},s.getScaleInKey=function f(a,h){const u=new i.Interval(new e.Note("C",c.Accidental.NATURAL),s.toNote(h));return a.map(g=>u.transposeUp(e.Note.fromString(g)).letterName)}}(r||(t.Key=r={}))},4028:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbsoluteNote=void 0;const e=n(5442),i=n(8795),c=n(3781),r=n(1072);class s extends e.Note{get name(){return this._letter+i.Accidental.toString(this._accidental)+this._octave}constructor(l,m,f){super(l,m),this._octave=f,this._midi=c.Scale.Major.semitones[(0,r.scalePosition)(this._letter)]+this._accidental+12*Number(this._octave)+12}get midi(){return this._midi}get octavePosition(){return this._octave}get absolute(){return!0}static getClosest(l,m){if((0,r.scalePosition)(m.letterName)>c.Scale.Major.notes.length/2){const h=new s(l.letterName,l.accidental,m.octavePosition),u=new s(l.letterName,l.accidental,m.octavePosition+1);return Math.abs(h.midi-m.midi)<Math.abs(u.midi-m.midi)?h:u}const f=new s(l.letterName,l.accidental,m.octavePosition-1),a=new s(l.letterName,l.accidental,m.octavePosition);return Math.abs(f.midi-m.midi)<Math.abs(a.midi-m.midi)?f:a}static fromString(l){const m=l.match(/^([a-zA-Z])(#{1,2}|b{1,2}|)?([0-9])$/);if(null==m)throw l+" is invalid";const[f,a,h]=m.slice(1),u=i.Accidental.fromString(a||"")||i.Accidental.NATURAL,g=Number(h);return new s(f,u,g)}}t.AbsoluteNote=s},5442:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Note=void 0;const e=n(8795),i=n(1072),r=[0,2,4,5,7,9,11,12];class s{constructor(l,m){if(this._letter=l,this._accidental=m,1!==l.length||l.toLowerCase()<"a"||l.toLowerCase()>"g")throw l+" is not [A-Ga-g]"}get chromaticPosition(){return(r[(0,i.scalePosition)(this._letter)]+this._accidental+12)%12}get letterName(){return this._letter}get accidental(){return this._accidental}get simpleName(){return this._letter+e.Accidental.toString(this._accidental)}get name(){return this.simpleName}get absolute(){return!1}applyAccidental(l){return new s(this.letterName,this.accidental+l)}static fromString(l){const m=l.match(/^([a-gA-G])(#{1,2}|b{1,2}|)?/);if(null==m)throw l+" is invalid";const[f,a]=m.slice(1),h=e.Accidental.fromString(a||"")||e.Accidental.NATURAL;return new s(f,h)}}t.Note=s},1163:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PartWriter=t.PartWriterParameters=void 0,t.nestedMinGenerator=p;const e=n(5202),i=n(9035),c=n(6195),r=n(3781),s=n(1348),o=n(6600),l=n(8496),m=n(6075),f=n(4028),a=n(5442),h=n(4755),u=n(3220),g=n(5730),d=n(7467),U=n(6213),I=n(2349),ae=n(9148),ie=n(7587),P=n(7229),O=n(560);function A(z,v,C){[z[v],z[C]]=[z[C],z[v]]}const G=(z,v)=>z+v;function*p(z,v,C){let j=0;const _=Array.from(z),T=new Array(_.length),K=_.map(v);for(;_.length>j;){let R=j;for(let V=j+1;V<_.length;V++){let Y=T[R];Y||(Y=C(_[R]),T[R]=Y);const ee=(0,I.lazyArrayMerge)(K[R],Y,G);if((0,g.arrayComparator)(ee,K[V])>0){R=V;continue}let ce=T[V];ce||(ce=C(_[V]),T[V]=ce),(0,g.arrayComparator)(ee,(0,I.lazyArrayMerge)(K[V],ce,G))>0&&(R=V)}A(_,j,R),A(T,j,R),A(K,j,R),yield _[j],j++}}var k=function(z){return z.greedyOrdering=v=>v,z.defaultOrdering=(v,C,j)=>(0,u.minGenerator)(v,_=>(C.length?e.PartWriting.Preferences.lazyEvaluateAll:e.PartWriting.Preferences.lazyEvaluateSingle)(j.partWritingParams,_[0],C[0]),g.arrayComparator),z.depthOrdering=(v,C,j)=>p(v,_=>(C.length?e.PartWriting.Preferences.lazyEvaluateAll:e.PartWriting.Preferences.lazyEvaluateSingle)(j.partWritingParams,_[0],C[0]),_=>(0,ae.minValueGenerator)(_[1],T=>e.PartWriting.Preferences.lazyEvaluateAll(j.partWritingParams,T[0],_[0]),g.arrayComparator).next().value||[]),z}(k||(t.PartWriterParameters=k={}));t.PartWriter=class J{constructor(v={yieldOrdering:k.defaultOrdering},C=e.defaultPartWritingParameters,j=new i.Harmonizer({})){this.partWriterParams=v,this.partWritingParams=C,this.harmonizer=j}*voiceAll(v,C){for(let S=1;S<v.length;S++){const w=e.PartWriting.Rules.checkAll(this.partWritingParams,v.slice(0,S+1).reverse()).next().value;if(w)throw"Failed rule "+w+" on constraint "+S}const j=v[0].romanNumeral||new l.RomanNumeral({scaleDegree:P.ScaleDegree.TONIC,quality:C[1]===r.Scale.Quality.MAJOR?O.ChordQuality.MAJOR:O.ChordQuality.MINOR},C),_=function Q(z,v){var C,j,_,T,K,R,V,Y,ee,ce,S,w,$,X,ne;const fe=(y,E)=>!y||!E||y==E;for(const y in z.voices)if(!fe(null===(C=z.voices[y])||void 0===C?void 0:C.name,null===(j=v.voices[y])||void 0===j?void 0:j.name))return null;if(!(fe(null===(T=null===(_=z.romanNumeral)||void 0===_?void 0:_.root)||void 0===T?void 0:T.name,null===(R=null===(K=v.romanNumeral)||void 0===K?void 0:K.root)||void 0===R?void 0:R.name)&&fe(null===(V=z.romanNumeral)||void 0===V?void 0:V.name,null===(Y=v.romanNumeral)||void 0===Y?void 0:Y.name)&&fe(null===(ee=z.romanNumeral)||void 0===ee?void 0:ee.scale[0],null===(ce=v.romanNumeral)||void 0===ce?void 0:ce.scale[0])&&fe(null===(S=z.romanNumeral)||void 0===S?void 0:S.scale[1],null===(w=v.romanNumeral)||void 0===w?void 0:w.scale[1])))return null;if(z.flags)for(const y in z.flags)if(v.flags&&void 0!==v.flags[y]&&z.flags[y]!==v.flags[y])return null;if(v.flags)for(const y in v.flags)if(z.flags&&void 0!==z.flags[y]&&z.flags[y]!==v.flags[y])return null;if(z.romanNumeral){const y=z.romanNumeral,E=y?.intervals.map(B=>y.root?B.transposeUp(y.root).simpleName:void 0);if(!v.voices.filter(h.isDefined).every(B=>E.includes(B.simpleName)))return null}else if(v.romanNumeral){const y=v.romanNumeral,E=y.intervals.map(B=>y.root?B.transposeUp(y.root).simpleName:void 0);if(!z.voices.filter(h.isDefined).every(B=>E.includes(B.simpleName)))return null}const x=null===($=z.romanNumeral||v.romanNumeral)||void 0===$?void 0:$.with(Object.assign(Object.assign({},null===(X=z.romanNumeral)||void 0===X?void 0:X.flags),null===(ne=v.romanNumeral)||void 0===ne?void 0:ne.flags)),se=[...new Array(Math.max(z.voices.length,v.voices.length))].map((y,E)=>z.voices[E]||v.voices[E]),te=Object.assign(Object.assign({},z.flags||{}),v.flags||{});return new c.IncompleteChord({romanNumeral:x,voices:se,flags:te})}(v[0],new c.IncompleteChord({romanNumeral:j}));if(!_)throw"Failed to reconcile first constraint";{const S=e.PartWriting.Rules.checkSingular(this.partWritingParams,_).next().value;if(S)throw"First reconciled constraint failed rule "+S}const T=this.harmonizer.matchingCompleteHarmony(v,C),K=(0,U.makePeekableIterator)((0,s.resultsOfTotalLength)((0,d.nestedIterableFilter)(T,this.expansionIsVoiceable.bind(this)),v.length));if(!K.hasItems)return;const R=(0,s.convertToMultiIterator)(K[Symbol.iterator]()),V=this.voiceWithContext(v,R),Y=(0,s.convertToMultiIterator)(V),ee=(0,m.preorderNestedIterableMap)(Y,(S,w)=>this.partWriterParams.yieldOrdering(S,[...w.slice().reverse()],this));yield*(0,s.resultsOfLength)(ee,v.length)}*voiceWithContext(v,C,j=[]){if(v.length!==j.length)for(const[_,T]of C){const K=this.chordVoicings(_,j);yield*(0,m.postorderNestedIterableMap)(K,(R,V)=>(0,ie.defaultChainedIterator)(R,()=>this.voiceWithContext(v,T,[...V.slice().reverse(),...j])))}}*chordVoicings(v,C=[]){if(0!==v.length)for(const j of this.chordVoicing(v[0],C))yield[j,this.chordVoicings(v.slice(1),[j,...C])]}*chordVoicing(v,C=[]){const j=S=>w=>[new f.AbsoluteNote(w.letterName,w.accidental,S.octavePosition+1),new f.AbsoluteNote(w.letterName,w.accidental,S.octavePosition),new f.AbsoluteNote(w.letterName,w.accidental,S.octavePosition-1)],_=v.romanNumeral,T=_.intervals.map(S=>_.root?S.transposeUp(_.root):void 0).filter(h.isDefined),K=_.inversionInterval.transposeUp(_.root);let R,V,Y,ee;if(C.length){const S=$=>{const X=v.voices[$];return X instanceof f.AbsoluteNote?[X]:X instanceof a.Note?[X].flatMap(j(C[0].voices[$])):[...T].flatMap(j(C[0].voices[$]))},w=$=>(X,ne)=>Math.abs($.midi-X.midi)-Math.abs($.midi-ne.midi);R=S(0).sort(w(C[0].voices[0])),V=S(1).sort(w(C[0].voices[1])),Y=S(2).sort(w(C[0].voices[2])),ee=v.voices[3]instanceof f.AbsoluteNote?[v.voices[3]]:j(C[0].voices[3])(K).sort(w(C[0].voices[3]))}else{const S=w=>$=>{const X=v.voices[$];if(X instanceof f.AbsoluteNote)return[X];const ne=e.voiceRange[$][1].octavePosition,fe=e.voiceRange[$][2].octavePosition+1,x=(e.voiceRange[$][1].midi+e.voiceRange[$][2].midi)/2;return X instanceof a.Note?[X].flatMap(se=>[...Array(fe-ne).keys()].map(te=>new f.AbsoluteNote(se.letterName,se.accidental,te+ne))).sort((se,te)=>Math.abs(se.midi-x)-Math.abs(te.midi-x)):[...w].flatMap(se=>[...Array(fe-ne).keys()].map(te=>new f.AbsoluteNote(se.letterName,se.accidental,te+ne))).sort((se,te)=>Math.abs(se.midi-x)-Math.abs(te.midi-x))};R=S(T)(0),V=S(T)(1),Y=S(T)(2),ee=S([K])(3)}const ce=S=>{const w=new c.IncompleteChord(Object.assign(Object.assign({},v),{voices:S}));if(C.length){if(!e.PartWriting.Rules.testAll(this.partWritingParams,[w,...C]))return!1}else if(!e.PartWriting.Rules.testSingular(this.partWritingParams,w))return!1;return!0};for(const S of ee)for(const w of R)if(ce([w,void 0,void 0,S]))for(const $ of V)if(ce([w,$,void 0,S]))for(const X of Y){const ne=new o.CompleteChord([w,$,X,S],v.romanNumeral,v.flags);if(C.length){if(!e.PartWriting.Rules.testAll(this.partWritingParams,[ne,...C]))continue}else if(!e.PartWriting.Rules.testSingular(this.partWritingParams,ne))continue;yield ne}}expansionIsVoiceable(v,C){const j=C.flatMap(_=>_.slice()).reverse();for(let _=0;_<v.length;_++){if(!this.harmonyIsVoicable(v[_],j))return!1;j.unshift(v[_])}return!0}harmonyIsVoicable(v,C){const j=C[0]?[C[0],v]:[v];return(0,U.makePeekableIterator)((0,s.resultsOfLength)(this.chordVoicings(j),j.length)).hasItems}}},5202:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPartWritingParameters=t.PartWriting=t.voiceRange=void 0;const e=n(4028),i=n(4748),c=n(7320),r=n(5271),s=n(8927),o=n(2199),l=n(9003),m=n(7229),f=n(3781),a=n(4755),h=n(560),u=n(8795),g=n(9776),d=v=>e.AbsoluteNote.fromString(v),U=(v,C)=>v.filter(i.Interval.ofSize(C)).length,I=v=>v.scaleDegree===m.ScaleDegree.DOMINANT&&v.quality===h.ChordQuality.MAJOR&&v.accidental===u.Accidental.NATURAL,ae=v=>v.scaleDegree===m.ScaleDegree.SUBTONIC&&v.quality===h.ChordQuality.DIMINISHED&&v.accidental===u.Accidental.NATURAL,ie=v=>v.scaleDegree===m.ScaleDegree.SUPERTONIC&&v.quality===h.ChordQuality.MAJOR&&v.accidental===u.Accidental.FLAT;function O(v,C){return!(v instanceof e.AbsoluteNote&&C instanceof e.AbsoluteNote&&Math.abs(v.midi-C.midi)>3)&&"2"==new i.Interval(C,v).simpleSize}const A=["B3","C4","G5","A5"].map(d),G=["G3","G3","C5","D5"].map(d),p=["C3","C3","G4","A4"].map(d),Q=["D2","E2","C4","D4"].map(d);var k;t.voiceRange=[A,G,p,Q],function(v){let j,_;v.extendDefaultParameters=function C({newRules:T,newPreferences:K,newSingularRules:R,newRuleParameters:V,newSingularPreferences:Y,newPreferencesOrdering:ee}={}){return{rules:Object.assign(Object.assign({},t.defaultPartWritingParameters.rules),T||{}),singularRules:[...t.defaultPartWritingParameters.singularRules,...R||[]],ruleParameters:Object.assign(Object.assign({},t.defaultPartWritingParameters.ruleParameters),V||{}),preferences:Object.assign(Object.assign({},t.defaultPartWritingParameters.preferences),K||{}),singularPreferences:[...t.defaultPartWritingParameters.singularPreferences,...Y||[]],preferencesOrdering:[...ee||t.defaultPartWritingParameters.preferencesOrdering]}},function(T){let K;var S;let R;function*V(S,w){for(const $ of Object.keys(S.rules)){const X=S.ruleParameters[$];!1!==X&&!S.rules[$].apply(null,[X,...w])&&(yield $)}}function*ee(S,w){for(const $ of S.singularRules){const X=S.ruleParameters[$];!1!==X&&!S.rules[$].apply(null,[X,w])&&(yield $)}}(S=K=T.VoicingRules||(T.VoicingRules={})).range=function w(te,{voices:y}){for(const[E,B]of(0,o.zip)(te.ranges||t.voiceRange,y))if(B&&(B.midi<E[0].midi||E[3].midi<B.midi))return!1;return!0},S.spelling=function $(te,{romanNumeral:y,intervals:E,voices:B}){if(!y||!E)return!0;if(!E.filter(a.isDefined).every(le=>y.intervals.map(he=>he.name).includes(le.name)))return!1;const re=B[B.length-1];return!re||re.simpleName===y.inversionInterval.transposeUp(y.root).name},S.leadingToneDoubling=function X(te,{romanNumeral:y,romanNumeralFinalized:E,intervals:B}){if(!E||y?.flags.sequence||!y||!B)return!0;if(y.name.startsWith("V")){if(B.filter(i.Interval.ofSize("3")).length>1)return!1}else if(y.name.startsWith("viio")&&B.filter(i.Interval.ofSize("U")).length>1)return!1;return!0},S.seventhDoubling=function ne(te,{romanNumeral:y,intervals:E}){return!E||!(y?.hasSeventh&&E.filter(i.Interval.ofSize("7")).length>1)},S.completeness=function fe(te,y,E){if(!(y.romanNumeral&&y.intervals&&y.voices.length&&y.voices.every(a.isDefined)))return!0;const B=y.intervals.filter(a.isDefined);if(0==U(B,"U")||0==U(B,"3"))return!1;if(y.romanNumeral.hasSeventh){if(0==U(B,"7"))return!1;if("U"!=y.romanNumeral.inversionInterval.simpleSize)return U(B,"5")>=1}else{if("U"!=y.romanNumeral.inversionInterval.simpleSize)return y.intervals.filter(i.Interval.ofSize("5")).length>=1;if(E&&!E.romanNumeral)return!0;if(!E||!E.romanNumeral.name.startsWith("V")||!E.romanNumeral.hasSeventh||0==U(E.intervals.filter(a.isDefined),"5"))return y.intervals.filter(i.Interval.ofSize("5")).length>=1}return!0},S.spacingAndCrossing=function x(te,{voices:y}){let E=0;for(E=0;E<y.length-2;E++){const le=y[E],he=y[E+1];if(le&&he&&le instanceof e.AbsoluteNote&&he instanceof e.AbsoluteNote&&(le.midi-he.midi>12||le.midi<he.midi))return!1}const B=y[E],re=y[E+1];return!(B&&re&&B instanceof e.AbsoluteNote&&re instanceof e.AbsoluteNote&&B.midi<re.midi)},S.accented64Doubling=function se(te,{romanNumeral:y,intervals:E}){return!y||!E||!(2===y.inversion&&!1===y.hasSeventh&&E.filter(i.Interval.ofSize("U")).length>1)},function(S){S.parallels=function w(oe,{voices:L},{voices:N}){return![[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]].map(([b,M])=>[N[b],N[M],L[b],L[M]]).filter(b=>b.every(a.isDefined)).filter(([b,M,H,D])=>M.name!=D.name&&b.name!=H.name).map(([b,M,H,D])=>[new i.Interval(M,b),new i.Interval(D,H)]).some(([b,M])=>"4"!=b.simpleSize&&b.quality==c.IntervalQuality.PERFECT&&b.name==M.name)},S.contraryFifths=function $(oe,{voices:L},{voices:N}){return!L.flatMap((b,M)=>L.map((H,D)=>[M,D])).filter(([b,M])=>b<M).map(([b,M])=>[N[b],N[M],L[b],L[M]]).filter(b=>b.every(a.isDefined)).filter(([b,M,H,D])=>s.Motion.from(b,M,H,D)==s.Motion.CONTRARY).map(([b,M,H,D])=>[new i.Interval(M,b),new i.Interval(D,H)]).some(([b,M])=>"4"!=b.simpleSize&&b.quality==c.IntervalQuality.PERFECT&&b.name==M.name)},S.voiceOverlap=function X(oe,{voices:L},{voices:N}){for(let F=0;F<L.length-1;F++){const b=L[F+1],M=L[F],H=N[F+1],D=N[F];if(M&&H&&M instanceof e.AbsoluteNote&&H instanceof e.AbsoluteNote&&M.midi<H.midi||D&&b&&D instanceof e.AbsoluteNote&&b instanceof e.AbsoluteNote&&D.midi<b.midi)return!1}return!0},S.hiddenFifths=function ne(oe,{voices:L},{voices:N,romanNumeral:F}){const b=L[L.length-1],M=L[0],H=N[N.length-1],D=N[0];if(!(b&&M&&H&&D&&b instanceof e.AbsoluteNote&&M instanceof e.AbsoluteNote&&H instanceof e.AbsoluteNote&&D instanceof e.AbsoluteNote))return!0;if("P5"==new i.Interval(b,M).name&&s.Motion.from(H,b,D,M)==s.Motion.SIMILAR){if(!F)return!0;if(!F.name.startsWith("V")&&"3"!=new i.Interval(F.root,D).simpleSize&&"m2"!=new i.Interval(D,M).name)return!1}return!0},S.leadingToneResolution=function fe(oe,{voices:L,romanNumeral:N,romanNumeralFinalized:F},{voices:b,romanNumeral:M,intervals:H}){if(!F||N?.flags.sequence||!M||!N||!H)return!0;if(!I(M)||I(N)||ae(N)){if(ae(M)&&!I(N)&&!ae(N)){const D=H.findIndex(i.Interval.ofSize("U")),Z=b[D],q=L[D];if(!Z||!q)return!0;if(-1===D)return!1;if("AU"===new i.Interval(q,Z).name)return!0;if("2"!=new i.Interval(Z,q).simpleSize)return!1}}else{const D=H.findIndex(i.Interval.ofSize("3")),Z=b[D],q=L[D];if(!Z||!q||"AU"===new i.Interval(q,Z).name)return!0;if("2"!==new i.Interval(Z,q).simpleSize){if(Z instanceof e.AbsoluteNote&&q instanceof e.AbsoluteNote&&Z.midi<q.midi||oe.disallowFrustratedLeadingTone)return!1;let me=!1;for(let ve=0;ve<D;ve++){const ge=L[ve];if(!ge)return!0;if("2"===new i.Interval(Z,ge).simpleSize){me=!0;break}}if(!me)return!1}}if(ie(M)&&!ie(N)){const D=H.findIndex(i.Interval.ofSize("U")),Z=b[D],q=L[D];if(!Z||!q)return!0;if(-1===D||!["m2","d3"].includes(new i.Interval(q,Z).name))return!1}return!0},S.seventhPreparation=function x(oe,{intervals:L,romanNumeral:N,voices:F},{romanNumeral:b,voices:M}){if(!b||!N?.hasSeventh||b.root===N.root&&b.hasSeventh||N.name.startsWith("V")||!L)return!0;const H=L.findIndex(i.Interval.ofSize("7"));if(-1===H)return!0;const D=M[H],Z=F[H];if(!D||!Z)return!0;if(!(D instanceof e.AbsoluteNote&&Z instanceof e.AbsoluteNote))return new Set(["U","2","7"]).has(new i.Interval(D,Z).simpleSize);try{const q=new r.ComplexInterval(D,Z).complexSize;if("U"===q||"2"===q)return!0}catch{}try{const q=new r.ComplexInterval(Z,D).complexSize;if("U"===q||"2"===q)return!0}catch{}return!1},S.seventhResolution=function se(oe,L,N,...F){var b,M,H,D,Z,q,me,ve,ge,Se,pe,Ae;if(F[0]&&(null===(b=F[0].romanNumeral)||void 0===b?void 0:b.scaleDegree)==m.ScaleDegree.TONIC&&"U"==(null===(M=F[0].romanNumeral)||void 0===M?void 0:M.inversionInterval.simpleSize)&&(null===(H=N.romanNumeral)||void 0===H?void 0:H.scaleDegree)==m.ScaleDegree.DOMINANT&&(null===(D=N.romanNumeral)||void 0===D?void 0:D.quality)==h.ChordQuality.MAJOR&&"5"==(null===(Z=N.romanNumeral)||void 0===Z?void 0:Z.inversionInterval.simpleSize)&&null!==(q=N.romanNumeral)&&void 0!==q&&q.hasSeventh&&(null===(me=L.romanNumeral)||void 0===me?void 0:me.scaleDegree)==m.ScaleDegree.TONIC&&"3"==(null===(ve=L.romanNumeral)||void 0===ve?void 0:ve.inversionInterval.simpleSize)){const de=null===(ge=N.intervals)||void 0===ge?void 0:ge.findIndex(i.Interval.ofSize("7"));if(void 0!==de&&-1!==de&&F[0].intervals&&N.intervals&&L.intervals&&"3"===(null===(Se=F[0].intervals[de])||void 0===Se?void 0:Se.simpleSize)&&"7"===(null===(pe=N.intervals[de])||void 0===pe?void 0:pe.simpleSize)&&"5"===(null===(Ae=L.intervals[de])||void 0===Ae?void 0:Ae.simpleSize))return!0}const Ie=[L,N,...F];for(let de=1;de<oe.scope;de++){const De=Ie[de].romanNumeral,Ce=Ie[de].intervals;if(De&&Ce&&De.hasSeventh){const Le=Ce.findIndex(i.Interval.ofSize("7")),Ne=Ie[de].voices[Le];if(!Ne)continue;for(let be=de-1;be>=0;be--){const Oe=Ie[be].voices[Le];if(Oe&&"U"!==new i.Interval(Oe,Ne).simpleSize){if("2"!==new i.Interval(Oe,Ne).simpleSize)return!1;break}}}}return!0},S.invalidIntervals=function te(oe,{voices:L,romanNumeral:N},{voices:F}){for(let b=0;b<F.length;b++){const M=F[b],H=L[b];if(!M||!H)continue;const D=new i.Interval(M,H);if("2"==D.simpleSize&&D.quality==c.IntervalQuality.AUGMENTED)return!1;if("7"==D.simpleSize&&D.quality==c.IntervalQuality.DIMINISHED||M instanceof e.AbsoluteNote&&H instanceof e.AbsoluteNote&&Math.abs(M.midi-H.midi)>7&&(!(3===b&&"U"===D.simpleSize&&D.quality===c.IntervalQuality.PERFECT&&M.midi-H.midi>0)||N&&0!==N.inversion))return!1}return!0},S.accented64Preparation=function y(oe,{romanNumeral:L,voices:N},{voices:F}){if(L&&2===L.inversion&&!1===L.hasSeventh){const b=N.findIndex(D=>D&&"U"===new i.Interval(L.root,D).simpleSize);if(-1===b)return!0;const M=N[b],H=F[b];return!M||!H||function P(v,C){return!(v instanceof e.AbsoluteNote&&C instanceof e.AbsoluteNote&&Math.abs(v.midi-C.midi)>3)&&new Set(["U","2","7"]).has(new i.Interval(v,C).simpleSize)}(H,M)}return!0},S.accented64Resolution=function E(oe,{romanNumeral:L,voices:N},{romanNumeral:F,voices:b}){if(F&&2===F.inversion&&!1===F.hasSeventh){if(L&&L.root.simpleName!==F.inversionInterval.transposeUp(F.root).simpleName)return!0;const M=b.findIndex(q=>q&&"U"===new i.Interval(F.root,q).simpleSize);if(-1===M)return!0;const H=b[M],D=N[M];if(!H||!D)return!0;if(!O(H,D))return!1;let Z=!1;for(let q=0;q<N.length;q++){const me=b[q];if(!me)return!0;if("3"!==new i.Interval(F.root,me).simpleSize)continue;const ve=b[q],ge=N[q];if(!ve||!ge)return!0;O(ve,ge)&&(Z=!0)}if(!Z)return!1}return!0},S.cadenceType=function B(oe,{flags:L,romanNumeral:N,voices:F},{romanNumeral:b}){if(!N||!b)return!0;if(L.pac){if(f.Scale.getNotesOfScale(N.scale)!==f.Scale.getNotesOfScale(b.scale)||"i"!==N.name.toLowerCase()||"V"!==b.name&&"V7"!==b.name)return!1;if(!F[0])return!0;if("U"!==new i.Interval(N.root,F[0]).simpleSize)return!1}else if(L.iac){if(f.Scale.getNotesOfScale(N.scale)!==f.Scale.getNotesOfScale(b.scale)||"i"!==N.name.toLowerCase()||"V"!==b.name&&"V7"!==b.name)return!1;if(!F[0])return!0;if("U"===new i.Interval(N.root,F[0]).simpleSize)return!1}else if(L.hc){if(f.Scale.getNotesOfScale(N.scale)!==f.Scale.getNotesOfScale(b.scale)||"V"!==N.name)return!1}else if(L.dc&&(f.Scale.getNotesOfScale(N.scale)!==f.Scale.getNotesOfScale(b.scale)||"i"===N.name.toLowerCase()||"V"===N.name.toLowerCase()||"vii"===N.name.toLowerCase()||"V"!==b.name&&"V7"!==b.name))return!1;return!0},S.voiceJumpStepsOpposite=function re(oe,{voices:L},{voices:N},{voices:F}={}){if(!F)return!0;const b=M=>"midi"in M;for(let M=0;M<L.length-1;M++){const H=F[M],D=N[M],Z=L[M];if(H&&D&&Z&&b(H)&&b(D)&&b(Z)){let q,me;if(q=D.midi>H.midi?new r.ComplexInterval(H,D):new r.ComplexInterval(D,H),new Set(["U","2","3"]).has(q.complexSize))continue;if(me=Z.midi>D.midi?new r.ComplexInterval(D,Z):new r.ComplexInterval(Z,D),"2"!==me.complexSize)return!1;if(D.midi>H.midi){if(Z.midi>D.midi)return!1;continue}if(Z.midi>D.midi)continue;return!1}}return!0},S.sequence=function le(oe,{voices:L,romanNumeral:N},{romanNumeral:F},b){if(!b)return!0;const{romanNumeral:M,voices:H}=b;if(N?.flags.sequence&&F?.flags.sequence&&M?.flags.sequence&&M?.inversionString===N?.inversionString)for(let D=0;D<L.length;D++){if(!N||!M)continue;const Z=H[D],q=L[D];if(!Z||!q)return!0;const me=new i.Interval(q,Z);if(new i.Interval(N.root,M.root).simpleSize!==me.simpleSize||q instanceof e.AbsoluteNote&&Z instanceof e.AbsoluteNote&&Math.abs(q.midi-Z.midi)>7)return!1}return!0},S.rapidKeyChange=function he({scope:oe},L,...N){if(L.flags.pivot)for(let F=0;F<N.length&&F<oe;F++)if(N[F].flags.pivot)return!1;return!0}}(R=T.HorizontalRules||(T.HorizontalRules={})),T.checkAll=V,T.testAll=function Y(S,w){return void 0===V(S,w).next().value},T.checkSingular=ee,T.testSingular=function ce(S,w){return void 0===ee(S,w).next().value}}(j=v.Rules||(v.Rules={})),function(T){let K;var S;let R;(S=K=T.VoicingRules||(T.VoicingRules={})).checkDoubling=function w(x){if(x.romanNumeral.hasSeventh){if(0==U(x.intervals,"5")&&2!=U(x.intervals,"U"))return-1}else{if(0==U(x.intervals,"5")&&"U"==x.romanNumeral.inversionInterval.simpleSize)return 3!=U(x.intervals,"U")?-2:-1;if("U"==x.romanNumeral.inversionInterval.simpleSize){if(2!=U(x.intervals,"U"))return-1}else if("3"!=x.romanNumeral.inversionInterval.simpleSize&&2!=U(x.intervals,"5"))return-1}return 0},S.checkVoiceCrossing=function $(x){let se=0;for(let te=1;te<x.voices.length-2;te++)x.voices[te].midi<x.voices[te+1].midi&&(se-=1);return se},S.checkRange=function X(x){let se=0;for(const[te,y]of[[A,x.voices[0]],[G,x.voices[1]],[p,x.voices[2]],[Q,x.voices[3]]])y.midi<te[1].midi&&(se-=1),te[2].midi<y.midi&&(se-=1);return se},S.checkSharedPitch=function ne(x){let se=0;for(let te=1;te<x.voices.length-1;te++)x.voices[te].midi===x.voices[te+1].midi&&(se-=1);return se},S.checkSequence=function fe(x){var se;return null!==(se=x.romanNumeral)&&void 0!==se&&se.flags.sequence?1:0},function(S){S.checkVoiceOverlap=function w(y,E){let B=0;for(let re=1;re<y.voices.length-2;re++)(y.voices[re].midi<E.voices[re+1].midi||E.voices[re].midi<y.voices[re+1].midi)&&(B-=1);return B},S.checkVoiceDisjunction=function $({voices:y},{voices:E}){let B=0;for(let re=0;re<y.length-1;re++){const le=Math.abs(y[re].midi-E[re].midi);B-=le*le}return B},S.checkBassOctaveJump=function X(y,E){if("i64"===E.romanNumeral.name.toLowerCase()&&"V"===y.romanNumeral.name||"i64"===E.romanNumeral.name.toLowerCase()&&"V7"===y.romanNumeral.name||"V"===E.romanNumeral.name&&"V7"===y.romanNumeral.name)try{if("P8"===new r.ComplexInterval(y.voices[y.voices.length-1],E.voices[y.voices.length-1]).name)return 1}catch{}else try{if("P8"===new r.ComplexInterval(y.voices[y.voices.length-1],E.voices[y.voices.length-1]).name)return-1}catch{}return 0},S.checkSequenceTarget=function ne({voices:y,romanNumeral:E},{romanNumeral:B},re){if(!re)return 0;const{romanNumeral:le,voices:he}=re;if(E?.flags.sequence&&B?.flags.sequence&&(le?.flags.sequence||le?.inversionString===E?.inversionString))for(let oe=0;oe<y.length;oe++){if(!E||!le)continue;const L=he[oe],N=y[oe];if(!L||!N)return 0;const F=new i.Interval(N,L);if(new i.Interval(E.root,le.root).simpleSize!==F.simpleSize||Math.abs(N.midi-L.midi)>7)return-1}return 0},S.checkCrossRelations=function fe({voices:y,romanNumeral:E},{voices:B,romanNumeral:re,intervals:le}){const he=(0,g.groupIndices)(B,L=>L.simpleName),oe=(0,g.findIndices)(y,(L,N)=>{var F;return(null===(F=he[L.simpleName])||void 0===F?void 0:F.length)>0&&!(ie(re)&&"U"===le[N].simpleSize)});return oe.every(L=>B[L].letterName===y[L].letterName&&B[L].octavePosition===y[L].octavePosition)?10:oe.every(L=>{var N;return(null===(N=he[y[L].letterName])||void 0===N?void 0:N.some(F=>B[F].octavePosition===y[L].octavePosition))||!0})?9:null!==E.applied&&"m2"==new i.Interval(y[y.length-1],f.Scale.getNotesOfScale(E.scale)[E.applied]).name&&1===oe.length&&he[y[oe[0]].letterName].every(L=>L>0)?5:0},S.checkRepetition=function x(y,E){return y.romanNumeral.name===E.romanNumeral.name?0:1},S.modulationToPredominant=function se(y){return!y.romanNumeral.flags.pivot||y.romanNumeral.scaleDegree!==m.ScaleDegree.TONIC&&y.romanNumeral.scaleDegree!==m.ScaleDegree.DOMINANT?0:-1},S.fewerModulations=function te(y){return y.romanNumeral.flags.pivot?-1:0}}(R=T.HorizontalRules||(T.HorizontalRules={})),T.evaluateSingle=function V(S,w){return S.preferencesOrdering.map(X=>S.singularPreferences.includes(X)?S.preferences[X]:ne=>0).map(X=>X.apply(null,[w]))},T.lazyEvaluateSingle=function Y(S,w){return(0,l.makeLazyArray)(S.preferencesOrdering.map(X=>S.singularPreferences.includes(X)?S.preferences[X]:ne=>0).map(X=>()=>X.apply(null,[w])))},T.evaluateAll=function ee(S,w,$){return S.preferencesOrdering.map(ne=>S.preferences[ne]).map(ne=>ne.apply(null,[w,$]))},T.lazyEvaluateAll=function ce(S,w,$){return(0,l.makeLazyArray)(S.preferencesOrdering.map(ne=>S.preferences[ne]).map(ne=>()=>ne.apply(null,[w,$])))}}(_=v.Preferences||(v.Preferences={}))}(k||(t.PartWriting=k={}));const J=Object.assign(Object.assign({},k.Rules.VoicingRules),k.Rules.HorizontalRules),z=Object.assign(Object.assign({},k.Preferences.VoicingRules),k.Preferences.HorizontalRules);t.defaultPartWritingParameters={rules:J,singularRules:Object.keys(k.Rules.VoicingRules),ruleParameters:{range:{ranges:t.voiceRange},seventhResolution:{scope:2},leadingToneResolution:{disallowFrustratedLeadingTone:!1},rapidKeyChange:{scope:3}},preferences:z,singularPreferences:["fewerModulations","modulationToPredominant","checkSequence","checkRange","checkDoubling","checkSharedPitch"],preferencesOrdering:["fewerModulations","modulationToPredominant","checkSequence","checkSequenceTarget","checkRepetition","checkRange","checkDoubling","checkVoiceCrossing","checkVoiceOverlap","checkBassOctaveJump","checkVoiceDisjunction","checkSharedPitch"]}},3781:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scale=void 0;const e=n(3508),i=n(5442),c=n(4748);var r;!function(s){let o;var I;let l,m,f,a;(I=o=s.Quality||(s.Quality={}))[I.MAJOR=0]="MAJOR",I[I.MINOR=1]="MINOR",function(I){I.notes=["C","D","E","F","G","A","B","C"],I.semitones=[0,2,4,5,7,9,11,12]}(l=s.Major||(s.Major={})),function(I){I.notes=["C","D","Eb","F","G","Ab","Bb","C"],I.semitones=[0,2,3,5,7,8,10,12]}(m=s.NaturalMinor||(s.NaturalMinor={})),function(I){I.notes=["C","D","Eb","F","G","Ab","B","C"],I.semitones=[0,2,3,5,7,8,11,12]}(f=s.HarmonicMinor||(s.HarmonicMinor={})),function(I){I.notes=["C","D","Eb","F","G","A","B","C"],I.semitones=[0,2,3,5,7,9,11,12]}(a=s.MelodicMinor||(s.MelodicMinor={}));const h=I=>2*I[0]+I[1],u=[];function g(I){if(!u[h(I)]){const ae=new c.Interval(i.Note.fromString("C"),e.Key.toNote(I[0])),ie=I[1]===o.MAJOR?l.notes:m.notes;u[h(I)]=ie.map(P=>ae.transposeUp(i.Note.fromString(P)))}return u[h(I)]}s.getNotesOfScale=g,s.getNamesOfScale=function d(I){return g(I).map(ae=>ae.name)},s.toString=function U(I){return e.Key.toString(I[0])+(I[1]===s.Quality.MAJOR?"M":"m")}}(r||(t.Scale=r={}))},4755:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isString=function n(c){return"string"==typeof c},t.isNumber=function e(c){return Number.isFinite(c)},t.isDefined=function i(c){return void 0!==c}},5730:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.arrayComparator=function n(e,i){for(let c=0;c<e.length&&c<i.length;c++){if(e[c]>i[c])return-1;if(e[c]<i[c])return 1}return 0}},9776:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.group=function n(c,r){return c.reduce((s,o)=>{const l=r(o),m=s[l]||[];return m.push(o),Object.assign(Object.assign({},s),{[l]:m})},{})},t.groupIndices=function e(c,r){return c.reduce((s,o,l)=>{const m=r(o),f=s[m]||[];return f.push(l),Object.assign(Object.assign({},s),{[m]:f})},{})},t.findIndices=function i(c,r){return c.reduce((s,o,l)=>(r(o,l)&&s.push(l),s),[])}},7587:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultChainedIterator=function*n(e,i){let c=!1;for(const r of e)c=!0,yield r;c||(yield*i())}},9355:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.iteratorMap=function*n(e,i){for(const c of e)yield i(c)}},2349:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lazyArrayMerge=function i(c,r,s){return(0,e.makeLazyArray)(new Array(Math.min(c.length,r.length)).fill(0).map((o,l)=>s.bind(void 0,c[l],r[l])))};const e=n(9003)},9003:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeLazyArray=function n(e){const i=new Array(e.length),c={get(r,s){if("length"==s)return i.length;if(void 0===i[s]){const o=e[s];o&&(i[s]=o())}return Reflect.get(...arguments)}};return new Proxy(i,c)}},518:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makeLazyMultiIterable=function n(e){const i=[];let c=0;const r={get:(s,o)=>{if(o==Symbol.iterator)return function*(){let l=0;for(;l<i.length;l++)yield i[l];let{done:m,value:f}=e.next();for(;!m;)i[l]=f,yield i[l],l++,({done:m,value:f}=e.next())};if("length"==o)return i.length;if("reset"==o&&(c=0),"next"==o)return()=>{if(c++,void 0===i[c])for(let l=c;l<o;l++){const m=e.next();if(m.done)break;return i[l]=m.value,{value:i[l]}}};if(void 0===i[o])for(let l=c;l<o;l++){const m=e.next();if(m.done)break;i[l]=m.value}return Reflect.get(...arguments)}};return new Proxy(i,r)}},6213:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.makePeekableIterator=function n(e){let i;const c=function*(){i&&(yield i);for(const s of e)i||(i=s),yield s}();return new Proxy({},{get:(s,o)=>o==Symbol.iterator?()=>c:"hasItems"==o?(i||(i=e.next().value),void 0!==i):Reflect.get(...arguments)})}},3220:(W,t)=>{function n(i,c,r){[i[c],i[r]]=[i[r],i[c]]}Object.defineProperty(t,"__esModule",{value:!0}),t.minGenerator=function*e(i,c,r){let s=0;const o=Array.from(i),l=o.map(c);for(;o.length>s;){let m=s;for(let f=s+1;f<o.length;f++)r(l[m],l[f])>0&&(m=f);n(o,s,m),yield o[s],s++}}},9148:(W,t)=>{function n(i,c,r){[i[c],i[r]]=[i[r],i[c]]}Object.defineProperty(t,"__esModule",{value:!0}),t.minValueGenerator=function*e(i,c,r){let s=0;const o=Array.from(i),l=o.map(c);for(;o.length>s;){let m=s;for(let f=s+1;f<o.length;f++)r(l[m],l[f])>0&&(m=f);n(o,s,m),n(l,s,m),yield l[s],s++}}},1348:(W,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unnestNestedIterable=function*c(a){for(const[h,u]of a){let g=!1;for(const d of c(u))g=!0,yield[h,...d];g||(yield[h])}},t.flattenResult=function*r(a){for(const[h,u]of a){let g=!1;for(const d of r(u))g=!0,yield[h,...d];g||(yield[h])}},t.flattenResults=function*s(a){for(const[h,u]of a){let g=!1;for(const d of s(u))g=!0,yield[h,...d].flatMap(U=>U);g||(yield[h].flatMap(d=>d))}},t.resultsOfLength=function*o(a,h){for(const[u,g]of a){const d=(0,i.makePeekableIterator)(o(g,h-1));(d.hasItems||1===h)&&(yield[u,d[Symbol.iterator]()])}},t.resultsOfTotalLength=function*l(a,h){for(const[u,g]of a){const d=(0,i.makePeekableIterator)(l(g,h-u.length));(d.hasItems||u.length===h)&&(yield[u,d[Symbol.iterator]()])}},t.convertToMultiIterator=function m(a){return(0,e.makeLazyMultiIterable)(function*h(u){for(const[g,d]of u)yield[g,(0,e.makeLazyMultiIterable)(h(d))]}(a))},t.convertToDeepNested=function*f(a){function*h(u,g){u.length?yield[u[0],h(u.slice(1),g)]:yield*f(g)}for(const[u,g]of a)yield*h(u,g)};const e=n(518),i=n(6213)},7467:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.nestedIterableFilter=function*n(e,i,c=[]){for(const[r,s]of e)i(r,c)&&(yield[r,n(s,i,[...c,r])])}},6075:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.preorderNestedIterableMap=function*n(i,c,r=[]){for(const[s,o]of c(i,r))yield[s,n(o,c,[...r,s])]},t.postorderNestedIterableMap=function*e(i,c,r=[]){yield*c(function*(){for(const[s,o]of i)yield[s,e(o,c,[...r,s])]}(),r)}},6991:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.product=function n(...e){return e.reduce((i,c)=>i.map(r=>c.map(s=>r.concat([s]))).reduce((r,s)=>r.concat(s),[]),[[]])}},1072:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scalePosition=function n(e){return(7+e.toLowerCase().charCodeAt(0)-97-2)%7}},2199:(W,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.zip=function n(...e){return e[0].map((i,c)=>e.map(r=>r[c]))}}},Me={},ue=function Pe(W){var t=Me[W];if(void 0!==t)return t.exports;var n=Me[W]={exports:{}};return ze[W](n,n.exports,Pe),n.exports}(2859);function ye(W){return W.match("[0-9]")?ue.U3.fromString(W):ue.L7.fromString(W)}function _e({key:W,minor:t,numerals:n,soprano:e,bass:i,canModulate:c,useProgressions:r,spacing:s,endCadence:o,search:l}){const m=[ue.Uz.fromString(W),void 0===t?ue.FE.Quality.MAJOR:ue.FE.Quality.MINOR],f=new Array(Math.max(n.length,e.length,i.length)).fill(0).map((U,I)=>new ue.jr({romanNumeral:n[I]?ue.E3.fromString(n[I],m):void 0,voices:[e[I]?ye(e[I]):void 0,void 0,void 0,i[I]?ye(i[I]):void 0]}));s&&(f[0]=new ue.jr({romanNumeral:ue.E3.fromString(n[0],m),voices:s.split(" ").map(U=>ye(U))})),o&&(f[f.length-1].flags[o]=!0);const a=new ue.md({canModulate:c,useProgressions:r}),g=new ue.p3({yieldOrdering:{default:ue.Rj.defaultOrdering,depth:ue.Rj.depthOrdering,greedy:ue.Rj.greedyOrdering}[l]},ue.vf,a).voiceAll(f,m);return(0,ue._E)(g).next().value}addEventListener("message",({data:W})=>{try{postMessage({result:_e(W)?.map(t=>({voices:t.voices.map(n=>n.name),romanNumeral:t.romanNumeral.name,scale:t.romanNumeral.scale,flags:t.flags}))})}catch(t){postMessage({error:t})}})})();